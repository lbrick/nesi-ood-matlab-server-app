# This script (`before.sh.erb`) is sourced directly into the main Bash script
# that is run when the batch job starts up. It is called before the `script.sh`
# is forked off into a separate process.
# Export the module function if it exists
[[ $(type -t module) == "function" ]] && export -f module

exec &> >(tee -a "pod.log")

source /bin/find_host_port

<%-
  require 'securerandom'
  mwitoken=SecureRandom.uuid
-%>
export MWI_ENABLE_TOKEN_AUTH=True
export MWI_AUTH_TOKEN="<%= mwitoken %>"

export MWI_APP_PORT="$PORT_CFG"
export MWI_APP_HOST="$HOST_CFG"